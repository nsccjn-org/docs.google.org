<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-4.5 docs-doc-page docs-doc-id-software/image" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">镜像制作手册 | NSCCJN</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.ai.nsccjn.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.ai.nsccjn.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.ai.nsccjn.org/docs/4.5/software/image"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="4.5"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.5"><meta data-rh="true" name="docsearch:version" content="4.5"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.5"><meta data-rh="true" property="og:title" content="镜像制作手册 | NSCCJN"><meta data-rh="true" name="description" content="平台内镜像制作文档"><meta data-rh="true" property="og:description" content="平台内镜像制作文档"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.ai.nsccjn.org/docs/4.5/software/image"><link data-rh="true" rel="alternate" href="https://docs.ai.nsccjn.org/docs/4.5/software/image" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://docs.ai.nsccjn.org/docs/4.5/software/image" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"工具指南","item":"https://docs.ai.nsccjn.org/docs/4.5/category/工具指南"},{"@type":"ListItem","position":2,"name":"镜像制作手册","item":"https://docs.ai.nsccjn.org/docs/4.5/software/image"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="NSCCJN RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="NSCCJN Atom Feed"><link rel="stylesheet" href="/assets/css/styles.543e9c57.css">
<script src="/assets/js/runtime~main.814bc16f.js" defer="defer"></script>
<script src="/assets/js/main.e5a33419.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.png"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="My  Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.png" alt="My  Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NSCCJN Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/4.5/intro">AI平台</a><a class="navbar__item navbar__link" href="/hpc/intro">HPC平台</a><a class="navbar__item navbar__link" href="/know/intro">知识库</a><a class="navbar__item navbar__link" href="/blog">公告</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/software/image">Version 4.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/software/image">Version 4.5</a></li><li><a class="dropdown__link" href="/docs/3.2/software/image">Version 3.2</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/intro">整体介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/homepage">首页</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.5/category/平台登录流程">平台登录流程</a><button aria-label="展开侧边栏分类 &#x27;平台登录流程&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/file">数据管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/deploy">业务管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/model">模型服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/metrics">监控告警</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/node-manager">资源管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/image">镜像管理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.5/os">系统管理</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/4.5/category/工具指南">工具指南</a><button aria-label="折叠侧边栏分类 &#x27;工具指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.5/software/jupyter">Jupyter Lab简介及常用操作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.5/software/soft">镜像组件安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/4.5/software/image">镜像制作手册</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.5/software/visual">可视化功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.5/software/pycharm">PyCharm对接开发环境</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.5/software/vscode">VSCode 对接AIStation开发环境</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>此为 <!-- -->NSCCJN<!-- --> <b>4.5</b> 版的文档，现已不再积极维护。</div><div class="margin-top--md">最新的文档请参阅 <b><a href="/docs/software/image">最新版本</a></b> (<!-- -->Next<!-- -->)。</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/4.5/category/工具指南"><span>工具指南</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">镜像制作手册</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：4.5</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>镜像制作手册</h1></header>
<p>平台内镜像制作文档</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-基础镜像">1. 基础镜像<a href="#1-基础镜像" class="hash-link" aria-label="1. 基础镜像的直接链接" title="1. 基础镜像的直接链接">​</a></h2>
<p>基础镜像都需要安装cuda、cudnn等深度学习必备组件，如果所制作的镜像对操作系统版本（官方镜像操作系统都是最新的）、cudnn版本没有要求，以及要求操作系统是ubuntu系统，都可以去NGC官网，下载指定cuda版本的基础镜像，参考1.1章节。<br>
<!-- -->如果镜像的操作系统版本为centos，或指定cuda、cudnn版本，NGC官方没有该基础镜像，则需要自制符合指定操作系统或cuda版本的基础镜像，具体参考1.2章节。</p>
<p>注意： 制作镜像，需要在联网环境下在线制作。由于与组件相关的依赖包较多，不推荐下载安装包离线安装的方式。本文以在线制作镜像为主，提供离线下载安装组件的命令。<br>
<!-- -->由于镜像中的操作系统都是MINI版，一般在线安装定制组件时，一些共享库或者组件依赖包不会被自动安装。在实际镜像制作过程中，可参考本文档安装所需的共享库或依赖包。若遇到难以解决的问题请联系我们。<br>
<!-- -->通过Dockerfile制作镜像，如果没有最终失败，请忽略在线制作镜像时输出的红色内容，这不影响最终制作的镜像。<br>
<!-- -->本文档，以某客户定制镜像制作作为示例，定制要求：<br>
<!-- -->操作系统：centos7.4<br>
<!-- -->numpy==1.15.4<br>
<!-- -->opencv-python==3.4.3.18<br>
<!-- -->tenserflow-gpu==1.8.0<br>
<!-- -->Keras==2.2.4<br>
<!-- -->python3.6.6<br>
<!-- -->cudnn 7.0<br>
<!-- -->cuda9.0</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-ngc官方基础镜像">1.1 NGC官方基础镜像<a href="#11-ngc官方基础镜像" class="hash-link" aria-label="1.1 NGC官方基础镜像的直接链接" title="1.1 NGC官方基础镜像的直接链接">​</a></h3>
<p>Ubuntu系统的cuda基础镜像，请在NGC官方网站下载，一般不需要单独制作，单独制作只针对centos版本。<br>
<!-- -->NGC官方基础镜像下载地址：<br>
<a href="https://ngc.nvidia.com/catalog/containers/nvidia:cuda/tags" target="_blank" rel="noopener noreferrer">https://ngc.nvidia.com/catalog/containers/nvidia:cuda/tags</a><br>
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.1.1-a716342a46e3d75eceb314a850608691.png" width="1267" height="599" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.1.2-1e1165c3992cd7e13598ce3e50eda0ce.png" width="1330" height="625" class="img_ev3q"></p>
<p>点击Pull Tag获取pull镜像命令，下载需要的基础镜像： docker pull nvcr.io/nvidia/cuda:9.0-cudnn7-devel-centos7
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.1.3-6bb077dbddf6a3d5d10663c122f87403.png" width="1902" height="136" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-自制带cuda的基础镜像">1.2 自制带cuda的基础镜像<a href="#12-自制带cuda的基础镜像" class="hash-link" aria-label="1.2 自制带cuda的基础镜像的直接链接" title="1.2 自制带cuda的基础镜像的直接链接">​</a></h3>
<p>由于客户定制的镜像，指定了操作系统，NGC官方镜像没有该基础镜像，需要自制基础镜像。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="121-下载dockerfile">1.2.1 下载Dockerfile<a href="#121-下载dockerfile" class="hash-link" aria-label="1.2.1 下载Dockerfile的直接链接" title="1.2.1 下载Dockerfile的直接链接">​</a></h4>
<p>下载指定版本的cuda和操作系统的Dockerfile和cuda.repo，然后再修改Dockerfile. <a href="https://gitlab.com/nvidia/container-images/cuda/-/tree/master/dist" target="_blank" rel="noopener noreferrer">https://gitlab.com/nvidia/container-images/cuda/-/tree/master/dist</a> （需要翻墙，才能访问）<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.1-1-0facd84dccbff8240a6ec347cfeb4e62.png" width="1268" height="636" class="img_ev3q">
点击centos7进入cuda版本选择，选择cuda9.0
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.1-2-2a6698a7a6270df1e13d4a09ac69d964.png" width="1267" height="455" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.1-3-7b7052163d7e30142b54d356b70524d2.png" width="1212" height="535" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.1-4-2b781ac602c699ab919a77f25acc0b37.png" width="1045" height="409" class="img_ev3q"></p>
<p>下载后，如图所示：<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.1-5-3b7475f8225c1dc388942b9133466a40.png" width="1033" height="378" class="img_ev3q">
gitlab cuda9.0下面，有base、devel、runtime目录，我们需要将每个下面的Dockerfile文件，汇总成一个Dockerfile文件，制作一个最全的cuda镜像，防止镜像使用GPU训练时出现问题。base、devel和runtime官方解释，如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> CUDA images come in three flavors and are available through the NVIDIA public hub repository.  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">base: starting from CUDA 9.0, contains the bare minimum (libcudart) to deploy a pre-built CUDA application. Use this image if you want to manually select which CUDA packages you want to install. runtime: extends the base image by adding all the shared libraries from the CUDA toolkit. Use this image if you have a pre-built application using multiple CUDA libraries. devel: extends the runtime image by adding the compiler toolchain, the debugging tools, the headers and the static libraries. Use this image to compile a CUDA application from sources.  </span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="122-修改dockerfile">1.2.2 修改Dockerfile<a href="#122-修改dockerfile" class="hash-link" aria-label="1.2.2 修改Dockerfile的直接链接" title="1.2.2 修改Dockerfile的直接链接">​</a></h4>
<p>将cuda9.0下面的所有Dockerfile汇总成一个Dockerfile，重复内容，只保留一份，汇总后的Dockerfile内容，如下：</p>
<div class="language-Dockerfile language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Dockerfile文件：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM centos:centos7.4.1708 ## 替换定制的操作系统版本，参考1.2.3 LABEL maintainer &quot;NVIDIA CORPORATION cudatools@nvidia.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN NVIDIA_GPGKEY_SUM=d1be581509378368edeec8c1eb2958702feedf3bc3d17011adbf24efacce4ab5 &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/rhel7/x86_64/7fa2af80.pub | sed &#x27;/^Version/d&#x27; &gt; /etc/pki/rpm-gpg/RPM-GPG-KEY-NVIDIA &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$NVIDIA_GPGKEY_SUM /etc/pki/rpm-gpg/RPM-GPG-KEY-NVIDIA&quot; | sha256sum -c --strict -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY cuda.repo /etc/yum.repos.d/cuda.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV CUDA_VERSION 9.0.176</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV CUDA_PKG_VERSION 9-0-$CUDA_VERSION-1 RUN yum install -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-cudart-$CUDA_PKG_VERSION &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s cuda-9.0 /usr/local/cuda &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/cache/yum/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## nvidia-docker 1.0 LABEL com.nvidia.volumes.needed=&quot;nvidia_driver&quot; LABEL com.nvidia.cuda.version=&quot;${CUDA_VERSION}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo &quot;/usr/local/nvidia/lib&quot; &gt;&gt; /etc/ld.so.conf.d/nvidia.conf &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;/usr/local/nvidia/lib64&quot; &gt;&gt; /etc/ld.so.conf.d/nvidia.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV PATH /usr/local/nvidia/bin:/usr/local/cuda/bin:${PATH} ENV LD_LIBRARY_PATH /usr/local/nvidia/lib:/usr/local/nvidia/lib64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## nvidia-container-runtime ENV NVIDIA_VISIBLE_DEVICES all ENV NVIDIA_DRIVER_CAPABILITIES compute,utility ENV NVIDIA_REQUIRE_CUDA &quot;cuda&gt;=9.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## runtime RUN yum install -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-libraries-$CUDA_PKG_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-cublas-9-0-9.0.176.4-1 &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/cache/yum/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cudnn（替换指定的cudnn版本，默认的是最新的，替换参考1.2.4） ENV CUDNN_VERSION 7.6.0.64 LABEL com.nvidia.cudnn.version=&quot;${CUDNN_VERSION}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuDNN license: https://developer.nvidia.com/cudnn/license_agreement RUN CUDNN_DOWNLOAD_SUM=90659ea77734b7b671afe930c9898d21a13b888998f1dd3940cc57d6b2f29b86 &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL http://developer.download.nvidia.com/compute/redist/cudnn/v7.6.0/cudnn-9.0-linux-x64-v7.6.0.64.tgz -O &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$CUDNN_DOWNLOAD_SUM cudnn-9.0-linux-x64-v7.6.0.64.tgz&quot; | sha256sum -c - &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar --no-same-owner -xzf cudnn-9.0-linux-x64-v7.6.0.64.tgz -C /usr/local --wildcards &#x27;cuda/lib64/libcudnn.so.*&#x27; &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm cudnn-9.0-linux-x64-v7.6.0.64.tgz &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## devel RUN rm -rf /usr/local/cuda-9.0/include &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-libraries-dev-$CUDA_PKG_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-nvml-dev-$CUDA_PKG_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-minimal-build-$CUDA_PKG_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-command-line-tools-$CUDA_PKG_VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-core-9-0-9.0.176.3-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-cublas-dev-9-0-9.0.176.4-1 &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/cache/yum/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV LIBRARY_PATH /usr/local/cuda/lib64/stubs</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="123-替换from基础镜像">1.2.3 替换FROM基础镜像<a href="#123-替换from基础镜像" class="hash-link" aria-label="1.2.3 替换FROM基础镜像的直接链接" title="1.2.3 替换FROM基础镜像的直接链接">​</a></h4>
<p>Dockerfile中的FROM操作系统镜像，换成自己需要的操作系统，操作系统镜像下载地址和查看操作系统镜像标签和版本地址如下：<br>
<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">https://hub.docker.com/</a> 在搜索框输入centos, 点击第一个官方centos，进入寻找需要的操作系统版本，替换FROM部分内容。
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.3-1-0ae12b3ff5a369183b690804b8287a77.png" width="1344" height="651" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.3-2-e90efb5dbcec7bed01071bd8f80e4e1e.png" width="1328" height="636" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="124-替换cudnn如果没有指定版本忽略该部分内容">1.2.4 替换cudnn（如果没有指定版本，忽略该部分内容）<a href="#124-替换cudnn如果没有指定版本忽略该部分内容" class="hash-link" aria-label="1.2.4 替换cudnn（如果没有指定版本，忽略该部分内容）的直接链接" title="1.2.4 替换cudnn（如果没有指定版本，忽略该部分内容）的直接链接">​</a></h4>
<p>由于官方cudnn中的Dockerfile中，cudnn都是最新的，如果需要指定版本，需要自己手动查找和修改该部分内容。<br>
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.4-1-28e7a33820cd372bf4e147ffc73269e3.png" width="1351" height="664" class="img_ev3q">
查看自己指定的cudnn版本链接：<a href="https://developer.nvidia.com/rdp/cudnn-archive" target="_blank" rel="noopener noreferrer">https://developer.nvidia.com/rdp/cudnn-archive</a><br>
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.4-2-da55f4f71109c10fa7d7b782c3d5b784.png" width="1300" height="672" class="img_ev3q">
点击下载，查看版本号:<br>
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.4-3-a129d7efb3a8b9e008ef9f86896eb2d5.png" width="400" height="471" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1241-在线cudnn">1.2.4.1 在线cudnn<a href="#1241-在线cudnn" class="hash-link" aria-label="1.2.4.1 在线cudnn的直接链接" title="1.2.4.1 在线cudnn的直接链接">​</a></h5>
<p>将## cudnn部分修改为如下内容</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## cudnn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV CUDNN_VERSION 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL com.nvidia.cudnn.version=&quot;${CUDNN_VERSION}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuDNN license: https://developer.nvidia.com/cudnn/license_agreement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN curl -fsSL http://developer.download.nvidia.com/compute/redist/cudnn/v7.0.5/cudnn-9.0-linux-x64-v7.tgz -O &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar --no-same-owner -xzf cudnn-9.0-linux-x64-v7.tgz -C /usr/local --wildcards &#x27;cuda/lib64/libcudnn.so.*&#x27; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm cudnn-9.0-linux-x64-v7.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1242-离线cudnn">1.2.4.2 离线cudnn<a href="#1242-离线cudnn" class="hash-link" aria-label="1.2.4.2 离线cudnn的直接链接" title="1.2.4.2 离线cudnn的直接链接">​</a></h5>
<p>如果上述在线下载出现问题，或者比较缓慢，可以使用离线cudnn，先下载cudnn tar包，然后和Dockerfile文件放到一起。
然后将Dockerfile中的## cudnn修改如下内容</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## cudnn ENV CUDNN_VERSION 7 LABEL com.nvidia.cudnn.version=&quot;${CUDNN_VERSION}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuDNN license: https://developer.nvidia.com/cudnn/license_agreement COPY cudnn-9.0-linux-x64-v7.tgz /home/cudnn-9.0-linux-x64-v7.tgz RUN tar --no-same-owner -xzf /home/cudnn-9.0-linux-x64-v7.tgz -C /usr/local &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm /home/cudnn-9.0-linux-x64-v7.tgz &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="125-其它部分修改">1.2.5 其它部分修改<a href="#125-其它部分修改" class="hash-link" aria-label="1.2.5 其它部分修改的直接链接" title="1.2.5 其它部分修改的直接链接">​</a></h4>
<p>devel RUN部分添加rm -rf /usr/local/cuda-9.0/include &amp;&amp; \，避免制作失败，根据cuda版本，修改该部分的cuda版本。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="126-在线制作cuda基础镜像">1.2.6 在线制作cuda基础镜像<a href="#126-在线制作cuda基础镜像" class="hash-link" aria-label="1.2.6 在线制作cuda基础镜像的直接链接" title="1.2.6 在线制作cuda基础镜像的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">## 进入Dockerfile目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/wjy/Dockerfile/cuda9.0-wjy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## build Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t centos7.4-cuda9.0-cudnn7.0-base-inspur:latest .</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.6-1-b19a97e36c491042c6761fb5207b6096.png" width="1895" height="729" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.6-2-80e80b0f867d79a563be47d6b4442b33.png" width="1618" height="807" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.6-3-9488028137888e2016ff05bd27ad828d.png" width="1890" height="805" class="img_ev3q">
报红内容，忽略，不影响安装，如果介意，修改cuda.repo中的gpgcheck=0，同时在Dockerfile最后一个RUN中添加 rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 &amp;&amp; \，解决该问题。
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.6-4-9754de5105eaf54643c2737da0880815.png" width="896" height="806" class="img_ev3q">
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.6-5-d974cf5e82f50bbfe1826b9db859ce0a.png" width="780" height="203" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="127-离线下载run安装的cuda组件如果在线制作顺利忽略该部分">1.2.7 离线下载RUN安装的cuda组件（如果在线制作顺利，忽略该部分）<a href="#127-离线下载run安装的cuda组件如果在线制作顺利忽略该部分" class="hash-link" aria-label="1.2.7 离线下载RUN安装的cuda组件（如果在线制作顺利，忽略该部分）的直接链接" title="1.2.7 离线下载RUN安装的cuda组件（如果在线制作顺利，忽略该部分）的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1271-离线下载cuda组件">1.2.7.1 离线下载cuda组件<a href="#1271-离线下载cuda组件" class="hash-link" aria-label="1.2.7.1 离线下载cuda组件的直接链接" title="1.2.7.1 离线下载cuda组件的直接链接">​</a></h5>
<p>Dockerfile在线制作过程中，如果网络环境不太好，可能导致在线制作时间特别长或者制作失败。可以离线Dockerfile RUN中yum在线安装的组件，然后，修改Dockerfile, 制作好后，再在制作的镜像中，离线安装这些组件。<br>
<!-- -->在linux下新建一个目录，用来下载离线cuda组件：<br>
<img decoding="async" loading="lazy" alt="image" src="data:image/png;base64,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" width="422" height="63" class="img_ev3q">
在终端执行如下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CUDA_VERSION=9.0.176</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CUDA_PKG_VERSION=9-0-$CUDA_VERSION-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install --downloadonly --downloaddir=/home/wjy/Dockerfile/components cuda-cudart-$CUDA_PKG_VERSION cuda-libraries-$CUDA_PKG_VERSION cuda-cublas-9-0-9.0.176.4-1 cuda-libraries-dev-$CUDA_PKG_VERSION cuda-nvml-dev-$CUDA_PKG_VERSION cuda-minimal-build-$CUDA_PKG_VERSION cuda-command-line-tools-$CUDA_PKG_VERSION cuda-core-9-0-9.0.176.3-1 cuda-cublas-dev-9-0-9.0.176.4-1</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.7.1-2-eb915d2edc061d3f8414a3bc50f5cd25.png" width="1036" height="622" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1272-修改dockerfile">1.2.7.2 修改Dockerfile<a href="#1272-修改dockerfile" class="hash-link" aria-label="1.2.7.2 修改Dockerfile的直接链接" title="1.2.7.2 修改Dockerfile的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM centos:centos7.4.1708</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL maintainer &quot;NVIDIA CORPORATION cudatools@nvidia.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN NVIDIA_GPGKEY_SUM=d1be581509378368edeec8c1eb2958702feedf3bc3d17011adbf24efacce4ab5 &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/rhel7/x86_64/7fa2af80.pub | sed &#x27;/^Version/d&#x27; &gt; /etc/pki/rpm-gpg/ RPM-GPG-KEY-NVIDIA &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;$NVIDIA_GPGKEY_SUM /etc/pki/rpm-gpg/RPM-GPG-KEY-NVIDIA&quot; | sha256sum -c --strict -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY cuda.repo /etc/yum.repos.d/cuda.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV CUDA_VERSION 9.0.176</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV CUDA_PKG_VERSION 9-0-$CUDA_VERSION-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN yum install -y \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cuda-cudart-$CUDA_PKG_VERSION &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s cuda-9.0 /usr/local/cuda &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/cache/yum/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## nvidia-docker 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL com.nvidia.volumes.needed=&quot;nvidia_driver&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL com.nvidia.cuda.version=&quot;${CUDA_VERSION}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN echo &quot;/usr/local/nvidia/lib&quot; &gt;&gt; /etc/ld.so.conf.d/nvidia.conf &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;/usr/local/nvidia/lib64&quot; &gt;&gt; /etc/ld.so.conf.d/nvidia.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV PATH /usr/local/nvidia/bin:/usr/local/cuda/bin:${PATH}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV LD_LIBRARY_PATH /usr/local/nvidia/lib:/usr/local/nvidia/lib64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## nvidia-container-runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NVIDIA_VISIBLE_DEVICES all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NVIDIA_DRIVER_CAPABILITIES compute,utility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV NVIDIA_REQUIRE_CUDA &quot;cuda&gt;=9.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## RUN yum install -y \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-libraries-$CUDA_PKG_VERSION \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-cublas-9-0-9.0.176.4-1 &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/cache/yum/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cudnn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV CUDNN_VERSION 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LABEL com.nvidia.cudnn.version=&quot;${CUDNN_VERSION}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## online cuda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuDNN license: https://developer.nvidia.com/cudnn/license_agreement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## RUN curl -fsSL http://developer.download.nvidia.com/compute/redist/cudnn/v7.0.5/cudnn-9.0-linux-x64-v7.tgz -O &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## tar --no-same-owner -xzf cudnn-9.0-linux-x64-v7.tgz -C /usr/local --wildcards &#x27;cuda/lib64/libcudnn.so.*&#x27; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## rm cudnn-9.0-linux-x64-v7.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## ldconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## offline cudnn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuDNN license: https://developer.nvidia.com/cudnn/license_agreement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY cudnn-9.0-linux-x64-v7.tgz /home/cudnn-9.0-linux-x64-v7.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN tar --no-same-owner -xzf /home/cudnn-9.0-linux-x64-v7.tgz -C /usr/local &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm /home/cudnn-9.0-linux-x64-v7.tgz &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## RUN rm -rf /usr/local/cuda-9.0/include &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## yum install -y \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-libraries-dev-$CUDA_PKG_VERSION \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-nvml-dev-$CUDA_PKG_VERSION \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-minimal-build-$CUDA_PKG_VERSION \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-command-line-tools-$CUDA_PKG_VERSION \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-core-9-0-9.0.176.3-1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## cuda-cublas-dev-9-0-9.0.176.4-1 &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /var/cache/yum/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENV LIBRARY_PATH /usr/local/cuda/lib64/stubs</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1273-进入build后的基础镜像中离线安装下载的cuda组件">1.2.7.3 进入build后的基础镜像中，离线安装下载的cuda组件<a href="#1273-进入build后的基础镜像中离线安装下载的cuda组件" class="hash-link" aria-label="1.2.7.3 进入build后的基础镜像中，离线安装下载的cuda组件的直接链接" title="1.2.7.3 进入build后的基础镜像中，离线安装下载的cuda组件的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/wjy/Dockerfile/cuda9.0-wjy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## build 镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t centos7.4-cuda9.0-cudnn7.0-base-inspur:latest .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 挂载cuda组件目录，进入镜像，安装cuda组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -it -v /home/wjy:/home/wjy centos7.4-cuda9.0-cudnn7.0-base-inspur:latest bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 在镜像中，进入cuda组件目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/wjy/components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 安装组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh *.rpm --force --nodeps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 安装成功后，保存镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker commit 容器ID centos7.4-cuda9.0-cudnn7.0-base-inspur:latest</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="128-验证基础镜像">1.2.8 验证基础镜像<a href="#128-验证基础镜像" class="hash-link" aria-label="1.2.8 验证基础镜像的直接链接" title="1.2.8 验证基础镜像的直接链接">​</a></h4>
<p>在装有GPU的环境，运行如下命令验证：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -it --runtime=nvidia -e NVIDIA_VISIBLE_DEVICES=1 centos7.4-cuda9.0-cudnn7.0-base-inspur:latest bash</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/image-1.2.8-1-3dddd6c4102b4bbc736291c84e683be2.png" width="1695" height="626" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-安装组件">2. 安装组件<a href="#2-安装组件" class="hash-link" aria-label="2. 安装组件的直接链接" title="2. 安装组件的直接链接">​</a></h2>
<p>安装组件，可以参照文档中的Dockerfile示例，编写安装定制组件的Dockerfile, 将FROM换成上面制作的基础镜像，然后在RUN中执行安装定制组件命令，Dockerfile RUN安装命令比较简单，不再详述。<br>
<!-- -->Dockerfile下载地址： <a href="https://github.com/wjyzzu/inpsur-dockerfile/tree/main/customization/centos7.4" target="_blank" rel="noopener noreferrer">https://github.com/wjyzzu/inpsur-dockerfile/tree/main/customization/centos7.4</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-安装python3">2.1 安装python3<a href="#21-安装python3" class="hash-link" aria-label="2.1 安装python3的直接链接" title="2.1 安装python3的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python 离线包下载地址：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://www.python.org/downloads/source/</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/image-2.1-1-c3bcde50cf528fa24599f21c4853ded8.png" width="1066" height="836" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-在本地服务器下载python366安装包">2.1.1 在本地服务器下载python3.6.6安装包：<a href="#211-在本地服务器下载python366安装包" class="hash-link" aria-label="2.1.1 在本地服务器下载python3.6.6安装包：的直接链接" title="2.1.1 在本地服务器下载python3.6.6安装包：的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/wjy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://www.python.org/ftp/python/3.6.6/Python-3.6.6.tgz</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-挂载homewjy目录到容器">2.1.2 挂载/home/wjy目录到容器：<a href="#212-挂载homewjy目录到容器" class="hash-link" aria-label="2.1.2 挂载/home/wjy目录到容器：的直接链接" title="2.1.2 挂载/home/wjy目录到容器：的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -i -t -v /home/wjy:/home/wjy centos7.4-cuda9.0-cudnn7.0-base-inspur:latest /bin/bash</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="213-安装python36">2.1.3 安装python3.6<a href="#213-安装python36" class="hash-link" aria-label="2.1.3 安装python3.6的直接链接" title="2.1.3 安装python3.6的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker exec -i -t 容器ID /bin/bash ## 进入基础镜像容器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y install make zlib zlib-devel bzip2-devel openssl-devel sqlite-devel readline-devel gdbm-devel gcc libffi-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf /home/wjy/Python-3.6.6.tgz -C /home/wjy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/wjy/Python-3.6.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/bin/python /usr/bin/python27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/bin/pip /usr/bin/pip27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s /usr/local/bin/python3 /usr/bin/python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -s /usr/local/bin/pip3 /usr/bin/pip</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="214-修改配置文件">2.1.4 修改配置文件<a href="#214-修改配置文件" class="hash-link" aria-label="2.1.4 修改配置文件的直接链接" title="2.1.4 修改配置文件的直接链接">​</a></h4>
<p>可使用如下快捷命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s## /usr/bin/python## /usr/bin/python2.7## &quot; /usr/bin/yum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s## /usr/bin/python## /usr/bin/python2.7## &quot; /usr/libexec/urlgrabber-ext-down</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python -V</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-安装tensorflow">2.2 安装tensorflow<a href="#22-安装tensorflow" class="hash-link" aria-label="2.2 安装tensorflow的直接链接" title="2.2 安装tensorflow的直接链接">​</a></h3>
<p>tensorflow 版本号查看和下载地址：<a href="https://pypi.org/project/tensorflow-gpu/1.8.0/" target="_blank" rel="noopener noreferrer">https://pypi.org/project/tensorflow-gpu/1.8.0/</a><br>
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-2.2-1-7ce4aafb59a8014afda726279a67dd11.png" width="1265" height="703" class="img_ev3q">
直接粘贴下载命令，在镜像中进行在线安装，或者查看历史版本，找到自己要安装的版本。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-安装">2.2.1 安装<a href="#221-安装" class="hash-link" aria-label="2.2.1 安装的直接链接" title="2.2.1 安装的直接链接">​</a></h4>
<p>在线安装如何总是失败或者网速过慢，可以使用pip download下载离线包，然后再进行安装。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install tensorflow-gpu==1.8.0 --user --default-timeout=10000 --ignore-installed --upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线下载：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip download tensorflow-gpu==1.8.0 -d /home/wjy/tian-tan-user-images/tensorflow-gpu1.8.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线加在线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install --find-links=/home/wjy/tian-tan-user-images/tensorflow-gpu1.8.0 tensorflow_gpu-1.8.0-cp36-cp36m-manylinux1_x86_64.whl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 完全离线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install --node-index --find-links=/home/wjy/tian-tan-user-images/tensorflow-gpu1.8.0tensorflow_gpu-1.8.0-cp36-cp36m-manylinux1_x86_64.whl</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-查看版本">2.2.2 查看版本<a href="#222-查看版本" class="hash-link" aria-label="2.2.2 查看版本的直接链接" title="2.2.2 查看版本的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip list |grep tensorflow</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-安装opencv">2.3 安装opencv<a href="#23-安装opencv" class="hash-link" aria-label="2.3 安装opencv的直接链接" title="2.3 安装opencv的直接链接">​</a></h3>
<p>opencv 查看版本和下载地址：<a href="https://pypi.org/project/opencv-python/3.4.3.18/" target="_blank" rel="noopener noreferrer">https://pypi.org/project/opencv-python/3.4.3.18/</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="231-安装">2.3.1 安装<a href="#231-安装" class="hash-link" aria-label="2.3.1 安装的直接链接" title="2.3.1 安装的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install opencv-python==3.4.3.18 --user --default-timeout=10000 --ignore-installed --upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线下载：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip download opencv-python==3.4.3.18 -d /home/wjy/tian-tan-user-images/opencv3.4.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install --find-links=/home/wjy/tian-tan-user-images/opencv3.4.3 opencv_python-3.4.3.18-cp27-cp27mu-manylinux1_x86_64.whl</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="232-查看版本">2.3.2 查看版本<a href="#232-查看版本" class="hash-link" aria-label="2.3.2 查看版本的直接链接" title="2.3.2 查看版本的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip list |grep opencv*</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="233-安装opencv共享库">2.3.3 安装opencv共享库<a href="#233-安装opencv共享库" class="hash-link" aria-label="2.3.3 安装opencv共享库的直接链接" title="2.3.3 安装opencv共享库的直接链接">​</a></h4>
<p>由于使用pip安装opencv后，并不会自动安装opencv共享库，需要手动安装，不然python import cv2时会报错。共享库：libSM.so.6, libXrender.so.1, libXext.so.6
<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-2.3.3-1-20d1e315ea1c4a481062d7e47ce39c13.png" width="813" height="475" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum whatprovides libSM.so.6 libXrender.so.1 libXext.so.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opencv1在线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install -y libSM libXrender libXext --setopt=protected_multilib=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">离线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum install --downloadonly --downloaddir=/home/wjy/opencv-share libSM-1.2.2-2.el7.x86_64 libXrender-0.9.10-1.el7.x86_64 libXext-1.3.3-3.el7.x86_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/wjy/opencv-share</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh *.rpm --force --nodeps</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-安装keras">2.4 安装Keras<a href="#24-安装keras" class="hash-link" aria-label="2.4 安装Keras的直接链接" title="2.4 安装Keras的直接链接">​</a></h3>
<p>Keras查看版本和下载地址：<a href="https://pypi.org/project/Keras/2.2.4/" target="_blank" rel="noopener noreferrer">https://pypi.org/project/Keras/2.2.4/</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="241-安装">2.4.1 安装<a href="#241-安装" class="hash-link" aria-label="2.4.1 安装的直接链接" title="2.4.1 安装的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">在线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install Keras==2.2.4 --user --default-timeout=10000 --ignore-installed --upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">离线下载：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip download Keras==2.2.4 -d /home/wjy/tian-tan-user-images/keras2.2.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">离线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install --no-index --find-links=/home/wjy/tian-tan-user-images/keras2.2.4 Keras-2.2.4-py2.py3-none-any.whl</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="242-查看版本">2.4.2 查看版本<a href="#242-查看版本" class="hash-link" aria-label="2.4.2 查看版本的直接链接" title="2.4.2 查看版本的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip list |grep Keras*</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-安装numpy">2.5 安装numpy<a href="#25-安装numpy" class="hash-link" aria-label="2.5 安装numpy的直接链接" title="2.5 安装numpy的直接链接">​</a></h3>
<p>numpy查看版本和下载地址：<a href="https://pypi.org/project/numpy/1.15.4/" target="_blank" rel="noopener noreferrer">https://pypi.org/project/numpy/1.15.4/</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="251-安装">2.5.1 安装<a href="#251-安装" class="hash-link" aria-label="2.5.1 安装的直接链接" title="2.5.1 安装的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install numpy==1.15.4 --user --default-timeout=10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线下载：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip download numpy==1.15.4 -d /home/wjy/tian-tan-user-images/numpy1.15.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线安装：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install --no-index --find-links=/home/wjy/tian-tan-user-images/numpy1.15.4 numpy-1.15.4-cp36-cp36m-manylinux1_x86_64.whl</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="252-查看版本">2.5.2 查看版本<a href="#252-查看版本" class="hash-link" aria-label="2.5.2 查看版本的直接链接" title="2.5.2 查看版本的直接链接">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-配置适配平台的组件">3. 配置适配平台的组件<a href="#3-配置适配平台的组件" class="hash-link" aria-label="3. 配置适配平台的组件的直接链接" title="3. 配置适配平台的组件的直接链接">​</a></h2>
<p>按照《镜像组件安装手册》安装openssh、openssl、jupyter组件；如果使用Dockerfile文件制作镜像，可以将《镜像组件安装手册》里面的Dockerfile内容合并到该文档的Dockerfile文件中，然后使用Dockerfile进行在线制作。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/4.5/software/soft"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">镜像组件安装</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/4.5/software/visual"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">可视化功能</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-基础镜像" class="table-of-contents__link toc-highlight">1. 基础镜像</a><ul><li><a href="#11-ngc官方基础镜像" class="table-of-contents__link toc-highlight">1.1 NGC官方基础镜像</a></li><li><a href="#12-自制带cuda的基础镜像" class="table-of-contents__link toc-highlight">1.2 自制带cuda的基础镜像</a></li></ul></li><li><a href="#2-安装组件" class="table-of-contents__link toc-highlight">2. 安装组件</a><ul><li><a href="#21-安装python3" class="table-of-contents__link toc-highlight">2.1 安装python3</a></li><li><a href="#22-安装tensorflow" class="table-of-contents__link toc-highlight">2.2 安装tensorflow</a></li><li><a href="#23-安装opencv" class="table-of-contents__link toc-highlight">2.3 安装opencv</a></li><li><a href="#24-安装keras" class="table-of-contents__link toc-highlight">2.4 安装Keras</a></li><li><a href="#25-安装numpy" class="table-of-contents__link toc-highlight">2.5 安装numpy</a></li><li><a href="#252-查看版本" class="table-of-contents__link toc-highlight">2.5.2 查看版本</a></li></ul></li><li><a href="#3-配置适配平台的组件" class="table-of-contents__link toc-highlight">3. 配置适配平台的组件</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">使用文档</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.nsccjn.org/docs/intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">AIStation v4.5<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://docs.nsccjn.org/docs/3.2/intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">AIStation v3.2<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://docs.nsccjn.org/hpc/intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">HPC<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">获取支持</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://ticket.nsccjn.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">提交工单<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">友情连接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.qlu.edu.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">齐鲁工业大学(山东省科学院)<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.nsccjn.cn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">国家超级计算济南中心<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 NSCCJN</div></div></div></footer></div>
</body>
</html>