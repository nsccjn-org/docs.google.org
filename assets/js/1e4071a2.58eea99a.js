"use strict";(self.webpackChunkawesometic_docs=self.webpackChunkawesometic_docs||[]).push([[1860],{28453:(e,n,c)=>{c.d(n,{R:()=>r,x:()=>s});var i=c(96540);const o={},t=i.createContext(o);function r(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(t.Provider,{value:n},e.children)}},29485:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>i,toc:()=>p});const i=JSON.parse('{"id":"software/3.5_env/hpcx","title":"HPCX","description":"AIstaton \u5e73\u53f0\uff0c\u4e00\u4e2a\u865a\u62df\u5316\u5e73\u53f0\uff0c\u57fa\u4e8edocker\u642d\u5efa\uff0c\u9002\u7528\u4e8eai \u8bad\u7ec3\u3001gpu \u52a0\u901f\u8ba1\u7b97\u7684\u5e73\u53f0\u3002","source":"@site/hpc/3_software/3.5_env/hpcx.md","sourceDirName":"3_software/3.5_env","slug":"/software/3.5_env/hpcx","permalink":"/hpc/software/3.5_env/hpcx","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"hpc","previous":{"title":"Google Authenticator","permalink":"/hpc/software/3.5_env/google"},"next":{"title":"Intel\u73af\u5883\u53d8\u91cf\u52a0\u8f7d","permalink":"/hpc/software/3.5_env/intel"}}');var o=c(74848),t=c(28453);const r={sidebar_position:3},s="HPCX",l={},p=[{value:"AIstaton \u5e73\u53f0\uff0c\u4e00\u4e2a\u865a\u62df\u5316\u5e73\u53f0\uff0c\u57fa\u4e8edocker\u642d\u5efa\uff0c\u9002\u7528\u4e8eai \u8bad\u7ec3\u3001gpu \u52a0\u901f\u8ba1\u7b97\u7684\u5e73\u53f0\u3002",id:"aistaton-\u5e73\u53f0\u4e00\u4e2a\u865a\u62df\u5316\u5e73\u53f0\u57fa\u4e8edocker\u642d\u5efa\u9002\u7528\u4e8eai-\u8bad\u7ec3gpu-\u52a0\u901f\u8ba1\u7b97\u7684\u5e73\u53f0",level:6},{value:"\u4e00\u3001\u4f7f\u7528\u8bf4\u660e",id:"\u4e00\u4f7f\u7528\u8bf4\u660e",level:3},{value:"\u4e8c\u3001\u5e73\u53f0\u57fa\u672c\u64cd\u4f5c",id:"\u4e8c\u5e73\u53f0\u57fa\u672c\u64cd\u4f5c",level:3},{value:"\u4e09\u3001\u4e0b\u8f7dhpc-x",id:"\u4e09\u4e0b\u8f7dhpc-x",level:3},{value:"\u56db\u3001\u5b89\u88c5\u6b65\u9aa4",id:"\u56db\u5b89\u88c5\u6b65\u9aa4",level:3},{value:"\u6839\u636e\u5f53\u524d\u73af\u5883\u7f16\u8bd1openmpi",id:"\u6839\u636e\u5f53\u524d\u73af\u5883\u7f16\u8bd1openmpi",level:4},{value:"\u6fc0\u6d3bhpc-x",id:"\u6fc0\u6d3bhpc-x",level:4},{value:"mpirun\u547d\u4ee4\u53c2\u6570",id:"mpirun\u547d\u4ee4\u53c2\u6570",level:4}];function a(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",h4:"h4",h6:"h6",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"hpcx",children:"HPCX"})}),"\n",(0,o.jsx)(n.h6,{id:"aistaton-\u5e73\u53f0\u4e00\u4e2a\u865a\u62df\u5316\u5e73\u53f0\u57fa\u4e8edocker\u642d\u5efa\u9002\u7528\u4e8eai-\u8bad\u7ec3gpu-\u52a0\u901f\u8ba1\u7b97\u7684\u5e73\u53f0",children:"AIstaton \u5e73\u53f0\uff0c\u4e00\u4e2a\u865a\u62df\u5316\u5e73\u53f0\uff0c\u57fa\u4e8edocker\u642d\u5efa\uff0c\u9002\u7528\u4e8eai \u8bad\u7ec3\u3001gpu \u52a0\u901f\u8ba1\u7b97\u7684\u5e73\u53f0\u3002"}),"\n",(0,o.jsx)(n.h3,{id:"\u4e00\u4f7f\u7528\u8bf4\u660e",children:"\u4e00\u3001\u4f7f\u7528\u8bf4\u660e"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"##1\u3001\u5171\u4eab\u76ee\u5f55\u4e3a \u201c/\u7528\u6237\u540d\u76ee\u5f55\u201d \uff0c\u6ce8\u610f\u5728\u5f53\u524d\u7528\u6237\u4e0b\uff0c\u521b\u5efa\u7684\u6240\u6709\u5f00\u53d1\u73af\u5883\u5171\u4eab\u76ee\u5f55\u4e3a\u540c\u4e00\u4e2a\n##2\u3001\u7f51\u7edc\u652f\u6301ib,ib\u9a71\u52a8\u5b58\u5728\u4e8e\u7269\u7406\u673a\u4e0a\uff0c\u5f53\u524d\u955c\u50cf\u5185\u6ca1\u6709\uff0c\u8c03\u7528\u65f6\u53ef\u7528\u901a\u8fc7\u6307\u5b9a\u7f51\u5361\u7684\u65b9\u5f0f\u8c03\u7528\n##3\u3001\u56e0\u7f51\u7edc\u9a71\u52a8\u5b58\u5728\u4e8e\u7269\u7406\u673a\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u6e90\u7801\u7f16\u8bd1mpi,\u53ef\u4ee5\u4f7f\u7528hpc-x\u73af\u5883\u5b89\u88c5mpi\u7684\u65b9\u5f0f\u6765\u66ff\u4ee3\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u4e8c\u5e73\u53f0\u57fa\u672c\u64cd\u4f5c",children:"\u4e8c\u3001\u5e73\u53f0\u57fa\u672c\u64cd\u4f5c"}),"\n",(0,o.jsx)(n.p,{children:"\u53c2\u8003\u6d6a\u6f6e\u666e\u901a\u7528\u6237\u64cd\u4f5c\u624b\u518c"}),"\n",(0,o.jsx)(n.h3,{id:"\u4e09\u4e0b\u8f7dhpc-x",children:"\u4e09\u3001\u4e0b\u8f7dhpc-x"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"https://developer.nvidia.com/networking/hpc-x ### \u4e0b\u8f7d\u5730\u5740\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u56db\u5b89\u88c5\u6b65\u9aa4",children:"\u56db\u3001\u5b89\u88c5\u6b65\u9aa4"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"cd hpcx\nexport HPCX_HOME=$PWD\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u6839\u636e\u5f53\u524d\u73af\u5883\u7f16\u8bd1openmpi",children:"\u6839\u636e\u5f53\u524d\u73af\u5883\u7f16\u8bd1openmpi"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ tar xfp ${HPCX_HOME}/sources/openmpi-gitclone.tar.gz\n$ cd ${HPCX_HOME}/sources/openmpi-gitclone\n$ ./configure CC=icc CXX=icpc F77=ifort FC=ifort --prefix=${HPCX_HOME}/ompi-icc \\\n--with-hcoll=${HPCX_HOME}/hcoll \\\n--with-ucx=${HPCX_HOME}/ucx \\\n--with-platform=contrib/platform/mellanox/optimized \\\n2>&1 | tee config-icc-output.log\n$ make -j32 all 2>&1 | tee build_icc.log && make -j24 install 2>&1 | tee install_icc.log\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u6fc0\u6d3bhpc-x",children:"\u6fc0\u6d3bhpc-x"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export HPCX_HOME=$PWD\ncd hpcx-v2.12-gcc-MLNX_OFED_LINUX-5-ubuntu18.04-cuda11-gdrcopy2-nccl2.12-x86_64/\nsource hpcx-init.sh\nhpcx_load\n\n##module \u65b9\u5f0f\u52a0\u8f7d\nmodule use $HPCX_HOME/modulefiles\nmodule load hpcx\n"})}),"\n",(0,o.jsx)(n.h4,{id:"mpirun\u547d\u4ee4\u53c2\u6570",children:"mpirun\u547d\u4ee4\u53c2\u6570"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"QUDA_ENABLE_P2P=3 /yangybai11/hpcx-v2.12-gcc-MLNX_OFED_LINUX-5-ubuntu18.04-cuda11-gdrcopy2-nccl2.12-x86_64/ompi/bin/mpirun --allow-run-as-root  -np 16 --host 192.208.79.37:8,192.224.8.14:8  -bind-to none -map-by slot -x LD_LIBRARY_PATH -x HOROVOD_MPI_THREADS_DISABLE=1 -x PATH -mca pml ucx -x NCCL_DEBUG=INFO -x NCCL_TREE_THRESHOLD=0 -x UCX_LOG_LEVEL=info ./hmc -i s1.0_restart_37540.xml -geom 1 2 2 4\n##--allow-run-as-root root \u6267\u884cmpirun \n##  -mca pml ucx UCX \u4e0e OpenSHMEM \u663e\u5f0f\u4f7f\u7528 \t\n## \n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"/etc/hosts ##\u8de8\u8282\u70b9\u4f5c\u4e1a\u65f6\uff0c\u53ef\u80fd\u9700\u8981ssh \u5404\u8282\u70b9\u4e4b\u95f4\u7684\u8fde\u63a5\n~/.ssh/known_hosts\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6ce8\u610f\uff1a\u8fd9\u4e2a\u5e73\u53f0\u7f51\u7edc\u5b58\u5728\u4e8e\u7269\u7406\u673a\u4e0a\uff0c\u5728\u5b9e\u4f8b\u73af\u5883\u4e2d\u8bbf\u95ee\u5b58\u5728\u95ee\u9898\uff0c\u4f7f\u7528  ",(0,o.jsx)(n.a,{href:"https://developer.nvidia.com/networking/hpc-x",children:"https://developer.nvidia.com/networking/hpc-x"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"https://content.mellanox.com/hpc/hpc-x/v2.12/hpcx-v2.12-gcc-MLNX_OFED_LINUX-5-ubuntu18.04-cuda11-gdrcopy2-nccl2.12-x86_64.tbz\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}}}]);